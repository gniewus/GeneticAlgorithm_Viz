/*!
 * Start Bootstrap - Grayscale v5.0.3 (https://startbootstrap.com/template-overviews/grayscale)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-grayscale/blob/master/LICENSE)
 */

"use strict";function loader(o){return function(){var e=Math.min(o.width,o.height)/2,t=2*Math.PI,n=d3.svg.arc().innerRadius(.5*e).outerRadius(.9*e).startAngle(0);d3.select(o.container).select("svg").append("g").attr("id","spiner").attr("transform","translate("+o.width/2+","+o.height/2+")").append("path").datum({endAngle:.33*t}).style("fill","#182a4d").attr("d",n).call(function e(t,n){t.transition().ease("linear").duration(n).attrTween("transform",function(){return d3.interpolateString("rotate(0)","rotate(360)")});setTimeout(function(){e(t,n)},n)},1500)}}function range1(e){return e?range1(e-1).concat(e):[]}var evolution_height=window.innerHeight/2,evolution_width=$("#evolution").parent().parent().width(),margin={top:5,right:20,bottom:5,left:20},width=evolution_width-margin.left-margin.right,height=evolution_height-margin.top-margin.bottom,format_number=d3.format("4.2f"),format=function(e){return str="Fitness: "+format_number(e.fitness),str+=" ,size: "+e.size+"("+format_number(e.scaled_size)+")",str+=" ,height: "+e.height+"("+format_number(e.scaled_height)+")",str},svg=d3.select("#evolution").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).attr("class","aligned").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),flowchart=d3.flowchart().node_width(12).node_height(5).size([width,height]);flowchart.sort_type($("input[name=sort_type]:checked").val()),flowchart.scale_type($("input[name=scale_type]:checked").val());var path=flowchart.link(),fitness_color=null,size_color=null,height_color=null,link_color=d3.scale.ordinal().domain([-1,0,1,2]).range(["red","blue","green","yellow"]);function intialize(e){if(console.log(e),0<e.nodes.length){svg.selectAll("g").remove(),flowchart.nodes(e.nodes).links(e.links).init();var t=0,n=0;flowchart.nodes().forEach(function(e){e.size>t&&(t=e.size),e.height>n&&(n=e.height)}),flowchart.nodes().forEach(function(e){e.scaled_size=1-e.size/t,e.scaled_height=1-e.height/n}),color_range=colorbrewer.RdYlGn[10],color_range_fitness=color_range.slice(0),fitness_color=d3.scale.quantile().domain(e.nodes.map(function(e){return e.fitness})).range(color_range_fitness),size_color=d3.scale.quantile().domain(e.nodes.map(function(e){return e.scaled_size})).range(color_range),height_color=d3.scale.quantile().domain(e.nodes.map(function(e){return e.scaled_height})).range(color_range),update_visualization();var o=flowchart.nodes()[flowchart.nodes().length-1];svg.selectAll("path.link.ancestor-of-"+o.key).classed("static-link-selected",!0),svg.selectAll("g.node.ancestor-of-"+o.key+" rect").classed("static-node-selected",!0),loader({width:evolution_width,height:window.innerHeight/2,container:"#evolution",id:"loader"})()}}function get_node_color(){return color_type=$("input[name=color_type]:checked").val(),"fitness"==color_type?function(e){return fitness_color(e.fitness)}:"size"==color_type?function(e){return size_color(e.scaled_size)}:"height"==color_type?function(e){return height_color(e.scaled_height)}:void 0}function reset_sankey(){flowchart.nodes([]).links([]).init(),svg.selectAll(".node").remove(),svg.selectAll(".link").remove()}function appendNewData(data){var newNodes=data.nodes,newLinks=data.links,oldNodes=flowchart.nodes(),oldLinks=flowchart.links(),t=d3.transition().duration(100),i=0,max_size=0,max_height=0;flowchart.nodes().forEach(function(e){e.size>max_size&&(max_size=e.size),e.height>max_height&&(max_height=e.height)}),flowchart.nodes().forEach(function(e){e.scaled_size=1-e.size/max_size,e.scaled_height=1-e.height/max_height}),oldNodes.length,flowchart.nodes(newNodes).links(newLinks).init(),64<=newNodes.length&&d3.select("#spiner").transition(t).remove(),svg.selectAll(".node").remove(),svg.selectAll(".link").remove(),flowchart.layout();var node=svg.selectAll(".node").data(flowchart.nodes(),function(e){return e.key});node.enter().append("g").attr("class",function(e){return str="node",e.ancestor_of?e.ancestor_of.forEach(function(e){str+=" ancestor-of-"+e}):console.error(e),str}).attr("transform",function(t){try{return"translate("+t.x+","+t.y+")"}catch(e){return void console.info(t)}}),node.exit().attr("transform",function(t){try{return"translate("+t.x+","+t.y+")"}catch(e){return void console.info(t)}});var rect=node.append("rect").attr("height",function(e){return e.dy}).attr("width",flowchart.node_width()).style("fill",get_node_color()).on("mouseover",mouseover).on("mouseout",mouseout).on("mousedown",mousedown).append("title").text(function(e){return format(e)}),link=svg.append("g").selectAll(".link").data(flowchart.links(),function(d){return d.key+"-"+d.generation+"-"+eval(d.generation+1)});link.enter().append("path").attr("class",function(e){return str="",-1==e.op?str="link link-strong":str="link link-normal",e.ancestor_of&&e.ancestor_of.forEach(function(e){str+=" ancestor-of-"+e}),str}).attr("d",path).style("stroke-width",function(e){return Math.max(1,e.dy)}).style("stroke",function(e){return link_color(e.op)}),link.exit().remove()}function update_visualization(e){flowchart.layout();var t=e?e.nodes:flowchart.nodes(),n=e?e.links:flowchart.links();flowchart.init();svg.selectAll("g").remove();svg.append("g").selectAll(".node").data(t,function(e){return e}).enter().append("g").attr("class",function(e){return str="node",e.ancestor_of&&e.ancestor_of.forEach(function(e){str+=" ancestor-of-"+e}),str}).attr("transform",function(t){try{return NaN==t.x?"translate("+Math.random(100)+","+t.y+")":"translate("+t.x+","+t.y+")"}catch(e){return console.error(t),"translate(0,0)"}}).append("rect").attr("height",function(e){return e.dy}).attr("width",flowchart.node_width()).style("fill",get_node_color()).on("mouseover",mouseover).on("mouseout",mouseout).on("mousedown",mousedown).append("title").text(function(e){return format(e)});svg.append("g").selectAll(".link").data(n).enter().append("path").attr("class",function(e){return str="",-1==e.op?str="link link-strong":str="link link-normal",e.ancestor_of&&e.ancestor_of.forEach(function(e){str+=" ancestor-of-"+e}),str}).attr("d",path).style("stroke-width",function(e){return Math.max(1,e.dy)}).style("stroke",function(e){return link_color(e.op)})}function update_color(){svg.selectAll("g.node rect").style("fill",get_node_color())}function change_visualization(){$("label > input[name=sort_type]").parent().removeClass("active"),$("label > input[name=sort_type]:checked").parent().addClass("active"),$("label > input[name=scale_type]").parent().removeClass("active"),$("label > input[name=scale_type]:checked").parent().addClass("active"),flowchart.sort_type($("input[name=sort_type]:checked").val()),flowchart.scale_type($("input[name=scale_type]:checked").val()),update_visualization()}function change_color(){$("label > input[name=color_type]").parent().removeClass("active"),$("label > input[name=color_type]:checked").parent().addClass("active"),update_color()}function mouseover(e){svg.selectAll("path.link.ancestor-of-"+e.key).classed("link-selected",!0),svg.selectAll("g.node.ancestor-of-"+e.key+" rect").classed("node-selected",!0)}function mouseout(e){svg.selectAll("path.link.ancestor-of-"+e.key).classed("link-selected",!1),svg.selectAll("g.node.ancestor-of-"+e.key+" rect").classed("node-selected",!1)}function mousedown(e){svg.selectAll("path.link").classed("static-link-selected",!1),svg.selectAll("g.node rect").classed("static-node-selected",!1),svg.selectAll("path.link.ancestor-of-"+e.key).classed("static-link-selected",!0),svg.selectAll("g.node.ancestor-of-"+e.key+" rect").classed("static-node-selected",!0)}d3.selectAll("input[name=sort_type]").on("click",change_visualization),d3.selectAll("input[name=scale_type]").on("click",change_visualization),d3.selectAll("input[name=color_type]").on("click",change_color);